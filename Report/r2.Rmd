---
title: "2013-2021 Police killings"
output:
  html_document: default
  pdf_document: default
---

  
# 3. Exploratory Data Analysis

## Mapping Police Violence 

### Table 1 : 2013 to 2021 police killings

#### 1) Cleaning the dataset 

To get started, we had to rearrange the dataset in order to retain only the variables and observations we needed. This dataset was huge, we had to concentrate on the essential : Moving from 53 variables to 12. Then we did basic modifications such as changing variable names, filtering the variables with NAs, changing some observations to make the understanding clearer. 
Our most important variables were : race, sex, state and date. These are the ones we are going to link with other datasets to run our hypothesis. 

```{r, echo = FALSE, message = FALSE, warning=FALSE}
library(shiny)
library(RColorBrewer)
library(mapproj)
library(gridExtra)
library(kableExtra)
library(MASS)
library(data.table)
library(car)
library(boot)
library(ISLR)
library(maps)
library(DT)
library(class)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(readr)
library(leaps)
library(glmnet)
library(corrplot)
library(glmnet)
library(pls)
library(leaps)
library(tree)
library(randomForest)
library(splines)
library(gam)
library(lmtest)
library(gbm)
library(corrplot)
library(ggplot2)
library(dplyr)
library(corrplot)
library(GGally)
library(sjPlot)
library(sjmisc)
library(sjlabelled)
library(readr)

X2013_2021_police_killings<- read_delim(file = here::here("Data/2013_2021_police_killings.csv"), 
     delim = ";", escape_double = FALSE, trim_ws = TRUE)

police_killings <- X2013_2021_police_killings %>% 
select(.,c(2:4,6,8:9,11,17,19,20,23:24)) ## Selecting the main variables
names(police_killings)[1:12]<-c("age","gender","race", "date_of_incident", "city","state","county","criminal_charges","mental_illness","armed_status","fleing","body_camera") ## Renaming the variables 
police_killings$date_of_incident<-as.Date(police_killings$date_of_incident,"%d/%m/%Y") #changing character to date type 
police_killings$date_of_incident<-format(police_killings$date_of_incident,"%Y") #changing the date format to Year only

##NA
#We don't want to delete the NAs from the other columns because some of these observations are related to known race/sex which are observations we need, so we switched them to "unknown" 

##Tiyding the observations
#Fleing
police_killings$fleing[police_killings$fleing %in% c("car","foot","Foot","Car","car,foot", "car, foot")]<-"yes"
police_killings$fleing[police_killings$fleing %in% c("not fleeing","Not fleeing","Not Fleeing")]<-"no"
police_killings$fleing[police_killings$fleing %in% c("Other")]<-"other"
#Simplifying the observations 

#Armed Status
police_killings$armed_status[police_killings$armed_status %in% c("Allegedly Armed")]<-"Allegedly armed"
police_killings$armed_status[police_killings$armed_status %in% c("Unarmed/Did Not Have Actual Weapon")]<-"Unarmed"
#Simplifying the observations

#Body Camera
police_killings$body_camera[police_killings$body_camera%in% c("Yes")]<-"yes"
police_killings$body_camera[police_killings$body_camera%in% c("Bystander Video","cell phone video","Dashcam video","Dashcam Video","No", "surveillance video", "Surveillance video","Surveillance Video")]<-"no"
#We have multiple observations here such as : Surveillance video, dashcam, bystander video, but we want only yes and no observations to make it easier. So every observations will be no unless it is "yes" or "Yes". The reason is that having a body camera has a lot more psychological pressure on a person than an external camera, because we might not know of it.

#Mental Illness
police_killings$mental_illness[police_killings$mental_illness %in% c("unknown")]<-"Unknown"
police_killings$mental_illness[police_killings$mental_illness %in% c("Drug or Alcohol Use, Drug or alcohol use")]<-"Yes"
police_killings$mental_illness[police_killings$mental_illness %in% c(NA)]<-"Unknown"
#Simplifying the observations

#criminal_charges
police_killings$criminal_charges[police_killings$criminal_charges %in% c("Charged, Plead No Contest, Sentenced to 10 years probation","Charged, Plead Guilty to Manslaughter, Sentenced to 5 years in prison", "Charged, Convicted, Sentenced to life in prison","Charged, Convicted, Sentenced to 7 years in prison","Charged, Convicted, Sentenced to 6 years in prison","Charged, Convicted, Sentenced to 5 years in prison","Charged, Convicted, Sentenced to 40 years to Life in prison","Charged, Convicted, Sentenced to 40 years in prison","Charged, Convicted, Sentenced to 4.75 years in prison","Charged, Convicted, Sentenced to 30 years in prison","Charged, Convicted, Sentenced to 3.5 years in prison","Charged, Convicted, Sentenced to 25 years in prison","Charged, Convicted, Sentenced to 2 years suspension and 3 years probation","Charged, Convicted, Sentenced to 18 months","Charged, Convicted, Sentenced to 10 years in prison","Charged, Convicted, Sentenced to 1 year in prison","Charged, Convicted, Sentenced to 1 year in jail, 3 years suspended","Charged, Convicted","Charged with a crime")]<-"Charged or sentenced"


```


#### 2) Analysing our variables 

In this part we analysed our most important variables : 

* Average Black and White people killed per State and per Year
* Percentage of black and white people killed 
* Percentage of male and female killed
* Percentage of officers charged
* Percentage of officers wearing a body camera
* Percentage of victim's armed
* Percentage of victim's showing a mental illness or incapacity to be clear minded

##### Table on black killings per state 

```{r, echo = FALSE, message = FALSE, warning=FALSE}
black_state_killings <- subset(police_killings, police_killings$race=="Black")
black_state_killings <- table(black_state_killings$`state`,black_state_killings$`date_of_incident`)
black_state_killings <- as.data.frame(black_state_killings)
black_state_killings <- black_state_killings %>%
     pivot_wider(names_from = Var2,
             values_from = Freq)
black_state_killings$`Average Black killing per year`<- round(rowMeans(black_state_killings[,2:9]),2)
black_state_killings <- arrange(black_state_killings,desc(`Average Black killing per year`))
names(black_state_killings)[1]<-"State"


kable(black_state_killings) %>% 
  kable_styling(fixed_thead = T, full_width = F, position = "left") %>% 
  row_spec(0, bold = T, italic = T, color = "white", background = "darkslategray") %>% 
  scroll_box(height = "400px", width = "75%")
```
In this table we rank the States from the one with the highest count of black killings from 2013 to 2021. We can see that the 3 states with the highest count are : California, Florida and Texas. And the 3 states with the lowest count are : Idaho, Maine and Montana.   

##### Table on White killings per state 

```{r, echo = FALSE, message = FALSE, warning=FALSE}

white_state_killings <- subset(police_killings, police_killings$race=="White")
white_state_killings <- table(white_state_killings$`state`,white_state_killings$`date_of_incident`)
white_state_killings <- as.data.frame(white_state_killings)
white_state_killings <- white_state_killings %>%
     pivot_wider(names_from = Var2,
             values_from = Freq)
white_state_killings$`Average White killing per year`<- round(rowMeans(white_state_killings[,2:9]),2)
white_state_killings <- arrange(white_state_killings,desc(`Average White killing per year`))
names(white_state_killings)[1]<-"State"


kable(white_state_killings) %>% 
  kable_styling(fixed_thead = T, full_width = F, position = "left") %>% 
  row_spec(0, bold = T, italic = T, color = "white", background = "darkslategray") %>% 
  scroll_box(height = "400px", width = "75%")
```

Here is the second table with the ranking of the States from the highest to the lowest average killing of White people from 2013 to 2021. We can see that the 3 first States are the same as the 1st table, however the 3 lasts are different (HI, Rhode Island, DC)

##### Death circumstances White people

```{r, echo = FALSE, message = FALSE, warning=FALSE}

white_victims <- subset(police_killings,race=="White")
white_victims <- data_frame(c("FALSE","TRUE"),
prop.table(table(white_victims$mental_illness=="Yes")), prop.table(table(white_victims$fleing == "yes")),
prop.table(table(white_victims$body_camera == "yes")),
prop.table(table(white_victims$armed_status == "Allegedly armed")),
prop.table(table(white_victims$criminal_charges == "Charged or sentenced")))
names(white_victims) <- c("Status", "Illness, alcohol or drugs", "Fleing", "Body_camera", "Armed", "Charged or sentenced")

white_victims$`Fleing` <- round(white_victims$`Fleing`*100,2)
white_victims$Body_camera <- round(white_victims$Body_camera*100,2)
white_victims$`Armed` <- round(white_victims$`Armed`*100,2)
white_victims$`Charged or sentenced` <- round(white_victims$`Charged or sentenced`*100,2)
white_victims$`Illness, alcohol or drugs` <- round(white_victims$`Illness, alcohol or drugs`*100,2)

kable(white_victims) %>% 
  kable_styling(fixed_thead = T, full_width = F, position = "left") %>% 
  row_spec(0, bold = T, italic = T, color = "white", background = "darkslategray") 
```

##### Death circumstances Black people

```{r, echo = FALSE, message = FALSE, warning=FALSE}
black_victims <- subset(police_killings,race=="Black")
black_victims <- data_frame(c("FALSE","TRUE"),
prop.table(table(black_victims$mental_illness=="Yes")), prop.table(table(black_victims$fleing == "yes")),
prop.table(table(black_victims$body_camera == "yes")),
prop.table(table(black_victims$armed_status == "Allegedly armed")),
prop.table(table(black_victims$criminal_charges == "Charged or sentenced")))
names(black_victims) <- c("Status", "Illness, alcohol or drugs", "Fleing", "Body_camera", "Armed", "Charged or sentenced")

black_victims$`Fleing` <- round(black_victims$`Fleing`*100,2)
black_victims$Body_camera <- round(black_victims$Body_camera*100,2)
black_victims$`Armed` <- round(black_victims$`Armed`*100,2)
black_victims$`Charged or sentenced` <- round(black_victims$`Charged or sentenced`*100,2)
black_victims$`Illness, alcohol or drugs` <- round(black_victims$`Illness, alcohol or drugs`*100,2)

kable(black_victims) %>% 
  kable_styling(fixed_thead = T, full_width = F, position = "left") %>% 
  row_spec(0, bold = T, italic = T, color = "white", background = "darkslategray") 
```

We created two tables comparing circumstances in black and white killings. We can see once again that there is a clear difference between the two races : 

* Black people are 2 times more likely to get killed regardless of their mental illness or incapacity to be clear minded
* Black people are 1.3 times more likely to get killed if they're fleeing 
* Black people are 1.2 times more likely to be unarmed when killed

However we can see that from 2013 to 2021 :

* 1% of white killings ended up charged and convicted with a crime against 1.53% for black killings, meaning that it seems like sentence over black killings are "harder".
* 16.12% police officers were wearing a body camera when they killed a black person against 9.28% for white people. In our hypothesis it could mean that police officers are less scared about the sentence they could get when the crime concerns a black person, however as we saw above, it doesnt match reality. 

These entries don't mean a lot of things like that, because there are other factors. It would be interesting to correlate the circumstances in between them.


```{r, echo = FALSE, message = FALSE, warning=FALSE}
bpk <- police_killings %>% 
count(., race=="Black", date_of_incident)
bpk <- subset(bpk,bpk$`race == "Black"`!="FALSE" )
names(bpk)[2:3] <- c("year", "black people killed")
bpk<- select(bpk,!c(1))
#creation of a table of black people killed throughout the years
wpk <- police_killings %>% 
     count(., race=="White", date_of_incident)
wpk <- subset(wpk,wpk$`race == "White"`!="FALSE" )
names(wpk)[2:3] <- c("year", "white people killed")
wpk<- select(wpk,!c(1))
#creation of a table of white people killed

killings_per_year<-merge(wpk, bpk, by="year")

tpk <- police_killings %>% 
    count(.,date_of_incident)
names(tpk)[1:2] <- c("year", "total people killed")

killings_per_year<- merge(killings_per_year, tpk, by="year") 
#merging all the tables because I don't know how to do it another way

killings_per_year<- killings_per_year %>% 
  mutate(.,"other people killed" = `total people killed`-`white people killed`-`black people killed`,             "perc_bpk" = round(`black people killed`/`total people killed`*100,2), 
         "perc_wpk" = round(`white people killed`/`total people killed`*100,2), 
         "perc_opk" = round(`other people killed`/`total people killed`*100,2))

killings_per_year <- killings_per_year[ ,c(1,2,7,3,6,5,8,4)]

kable(killings_per_year) %>% 
  kable_styling(fixed_thead = T, full_width = F, position = "left") %>% 
  row_spec(0, bold = T, italic = T, color = "white", background = "darkslategray") 

kable(summary(killings_per_year)) %>% 
  kable_styling(fixed_thead = T, full_width = F, position = "left") %>% 
  row_spec(0, bold = T, italic = T, color = "white", background = "darkslategray") 
```
In average, 964 people were killed each year since 2013, 0,28 % being black people and 0,48 being white people.

#### 3) Graphic vizualisation 

```{r, echo = FALSE, message = FALSE, warning=FALSE}
ggplot(police_killings)+geom_bar(mapping=aes(x=race,y=stat(prop), group=1)) 
ggplot(police_killings)+geom_bar(mapping=aes(x=race,fill=gender), position="fill")
```
We can see that between 2013 and 2021, White people were the most killed and Black people are the second most killed population.

The proportion of women killed is very little compared to men. However we can see that Asian, Native american and white women are more affected. 

#### Killings per year 
```{r, echo = FALSE, message = FALSE, warning=FALSE}

KPY <- pivot_longer(killings_per_year, c(`white people killed`,`black people killed`,`total people killed`), names_to = "population killed", values_to = "count")

KPY %>%
     filter(KPY$`population killed` %in% c("white people killed", "black people killed","total people killed")) %>%
    ggplot(aes(x = year, y = count, group = `population killed`, colour = `population killed`)) +
    geom_line()
```

The graph shows globally that the killings dropped a little since 2018, a decrease of about 150.


### Table 2 : 2013 to 2021 State killings

#### 1) Cleaning the dataset 

The second table is a summary of the killings by state. We have a table of 999 observations of 36 variables. We already see a problem because we should have 50 observations corresponding to the states. 


#### 2) Analyzing our variables

In this table we want to focus only on black versus white killings. Our main variables will be :

* State 
* State abbreviation 
* Total population 
* Black population 
* White population 
* Black people killed 
* White people killed 
* Total people killed 


```{r, echo = FALSE, message = FALSE, warning=FALSE}
library(readr)
Killingsbystate <- read_delim(file=here::here("Data/2013-2021_killings_by_state.csv"), delim = ";", escape_double = FALSE, trim_ws = TRUE)

Killingsbystate <- Killingsbystate %>%
subset(.,!`State Abbreviation`=="") %>%
arrange(.,desc(`Total Population`))
#Now we have 51 observations for 8 variables ordered from the most populated State to the least.
```

Our goal is to compare the ratio between Black and White killings to their population in each State. So we created a new dataframe substracted from the original one. We added columns for the White population killed and its percentage. 

```{r, echo = FALSE, message = FALSE, warning=FALSE}
#A table of the population and percent of k

kbs<- Killingsbystate %>%
select(.,c(1:3,21,11,12)) 

names(kbs)[6]<-"% Black victims"

kbs$`% White`<-Killingsbystate$`White Population`/Killingsbystate$`Total Population`*100
kbs$`% White victims` <- Killingsbystate$`# White people killed`/Killingsbystate$`# People Killed`*100

kbs$`% African-American`<-str_replace(kbs$`% African-American`, ",", ".")
kbs$`% Black victims`<-str_replace(kbs$`% Black victims`, ",", ".")

kbs$`% African-American`<-as.numeric(as.character(kbs$`% African-American`))
kbs$`% Black victims`<-as.numeric(as.character(kbs$`% Black victims`))

kbs$`% African-American`<-kbs$`% African-American`*100
kbs$`% Black victims`<-kbs$`% Black victims`*100


kbs <- kbs %>% 
  .[,c(1:3,5,7,4,6,8)] %>%
  mutate_at(vars(`% African-American`,`% White`,`% Black victims`,`% White victims`), funs(round(., 2)))
  
kable(kbs) %>% 
  kable_styling(fixed_thead = T, full_width = F, position = "left") %>% 
  row_spec(0, bold = T, italic = T, color = "white", background = "darkslategray") %>% 
  scroll_box(height = "400px", width = "100%")
  
view(kbs)
```
We can observe in this table that the percent of Black people killed compared to their population rate is higher than the White killings. It means that even though Black people represent less in each State, they're still more killed than White people. Let's take California for instance : Black people represent only 5.53% of the population but 15% of people killed are Black. Whereas White people represent 37.54% and only 27.3%of people killed are White. 

##### Summary of total Black and White people killed

```{r, echo = FALSE, message = FALSE, warning=FALSE}

total <- data.frame(c("Total","Black","White"),c(sum(Killingsbystate$`Total Population`),sum(Killingsbystate$`Black Population`),sum(Killingsbystate$`White Population`)))
names(total)<-c("race","count")
total$proportion<-c(total$count/322903030*100)
total$killed<-c(sum(killings_per_year$`total people killed`),sum(killings_per_year$`black people killed`),sum(killings_per_year$`white people killed`))
total$proportion_k<-c((9727/322903030*100),(2415/39715917*100),(4224/197181177*100))
names(total)<-c("Race","Total_pop","proportion_tp","pop_killed","proportion_k")

total$proportion_tp <- round(total$proportion_tp,2)
total$proportion_k <- round(total$proportion_k,3)

kable(total) %>% 
  kable_styling(fixed_thead = T, full_width = F, position = "left") %>% 
  row_spec(0, bold = T, italic = T, color = "white", background = "darkslategray") %>% 

```
After some calculation, we fount out that from 2013 to 2021, black people were killed 3 times more than white people : 0.006% black people killed against 0.002% white people killed. This clearly means that there is an existing discrimination against black people. However, it could be explained by other factors like the crime rate, and the circumstances of death, still there is a significant difference. 


#### 3) Graphic vizualisation 

##### Total people killed per State

```{r, echo = FALSE, message = FALSE, warning=FALSE}
ggplot(kbs)+geom_point(mapping=aes(x=`State Abbreviation`,y=`# People Killed`))
#a graph on the total killings of each state
```

##### Total population per State

```{r, echo = FALSE, message = FALSE, warning=FALSE}

ggplot(kbs)+geom_point(mapping=aes(x=`State Abbreviation`,y=`Total Population`)) #a graph on the total population of each state


```
  
We can see a slight correlation between the 2 graphs, the pattern is similar with the bigger cities having the highest count of deaths. 


